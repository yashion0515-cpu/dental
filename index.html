<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歯科医院情報登録フォーム</title>
    <script src="https://static.line-scdn.net/liff/sdk/2.16.1/liff.js"></script>
    <style>
        /* (スタイルは省略) */
        body { font-family: sans-serif; padding: 20px; }
        input { width: 100%; padding: 10px; margin-bottom: 15px; box-sizing: border-box; }
        button { background-color: #00B900; color: white; padding: 15px 20px; border: none; cursor: pointer; }
        .success-message { color: green; font-weight: bold; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    <h1>金乳歯 取扱歯科医院 登録</h1>
    <form id="registrationForm">
        <label for="hospitalName">歯科医院名:</label>
        <input type="text" id="hospitalName" required>

        <label for="representativeName">代表者名:</label>
        <input type="text" id="representativeName" required>

        <label for="address">住所:</label>
        <input type="text" id="address" required>

        <label for="phoneNumber">電話番号:</label>
        <input type="tel" id="phoneNumber" required>

        <button type="submit" id="submitButton">情報を登録する</button>
    </form>
    
    <div id="successMessage" class="success-message">
        登録が完了しました！<br>
        続いて振込口座のご登録をお願いします：<br>
        <a id="affiliateLink" href="https://affitch.com/signup?ref=yashio-gold" target="_blank">「振込口座等登録ページ」へ移動</a><br>
        登録完了後販促品をラインからご注文ください。<br>
    </div>


    <script>
        // 【重要】ここにGASで取得したウェブアプリのURLを記入します
        const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzaRGEl8LardvIO_jKxd5Mirf2-iwWi0ZHRC6ZPelxBfivVZavdj3v73LFJuq28EQ/exec';
        // 【重要】LIFF IDをここに設定します
        const LIFF_ID = '2008433362-nR8Alpk2'; 

        // 初期化の状態を追跡するフラグ
        let isLiffInitialized = false; 

        async function initializeLiff() {
            try {
                // LIFF IDの初期化のみ行い、ログイン認証は不要
                await liff.init({ liffId: LIFF_ID });
                console.log('LIFF initialization successful');
                isLiffInitialized = true; // 成功
            } catch (err) {
                // 変更点: alertを削除し、コンソールにログを出力するのみとする
                console.error('LIFF initialization failed. Please check LIFF ID and URL in LINE Developers Console.', err);
                // フォームの動作自体はLIFF機能を使用しないため、初期化失敗でも処理を進める
            }
        }

        document.getElementById('registrationForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const submitButton = document.getElementById('submitButton');
            submitButton.disabled = true;
            submitButton.textContent = '送信中...';
            
            // LIFF初期化の状態に関わらずデータ送信を実行（LINE ID不使用のため）

            try {
                // フォームデータを取得
                const formData = {
                    hospitalName: document.getElementById('hospitalName').value,
                    representativeName: document.getElementById('representativeName').value,
                    address: document.getElementById('address').value,
                    phoneNumber: document.getElementById('phoneNumber').value,
                };

                // GASのエンドポイントへデータを送信
                const response = await fetch(GAS_ENDPOINT, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();

                if (result.status === 'success') {
                    // 成功時の処理
                    document.getElementById('registrationForm').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                } else {
                    alert('データの送信に失敗しました: ' + result.message);
                }

            } catch (error) {
                console.error('Submission error:', error);
                alert('エラーが発生しました。時間を置いて再度お試しください。');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = '情報を登録する';
            }
        });

        // LIFFの初期化を開始
        initializeLiff();
    </script>
</body>
</html>
