<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¯ç§‘åŒ»é™¢æƒ…å ±ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://static.line-scdn.net/liff/sdk/2.16.1/liff.js"></script>
    <style>
        /* (ã‚¹ã‚¿ã‚¤ãƒ«ã¯çœç•¥) */
        body { font-family: sans-serif; padding: 20px; }
        input { width: 100%; padding: 10px; margin-bottom: 15px; box-sizing: border-box; }
        button { background-color: #00B900; color: white; padding: 15px 20px; border: none; cursor: pointer; }
        .success-message { color: green; font-weight: bold; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    <h1>é‡‘ä¹³æ­¯ å–æ‰±æ­¯ç§‘åŒ»é™¢ ç™»éŒ²</h1>
    <form id="registrationForm" style="display:none;"> <label for="hospitalName">æ­¯ç§‘åŒ»é™¢å:</label>
        <input type="text" id="hospitalName" required>

        <label for="representativeName">ä»£è¡¨è€…å:</label>
        <input type="text" id="representativeName" required>

        <label for="address">ä½æ‰€:</label>
        <input type="text" id="address" required>

        <label for="phoneNumber">é›»è©±ç•ªå·:</label>
        <input type="tel" id="phoneNumber" required>

        <button type="submit" id="submitButton">æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹</button>
    </form>
    
    <div id="loadingMessage">LIFFã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...</div>
    <div id="errorMessage" style="color:red; display:none;">
        <p>ğŸ”´ ã‚¨ãƒ©ãƒ¼ï¼šLIFFã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>
        <p>LINE Developersã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹LIFF IDã¾ãŸã¯LIFF URLãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="successMessage" class="success-message" style="display:none;">
        ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼<br>
        ç¶šã„ã¦ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚µã‚¤ãƒˆã¸ã®ç™»éŒ²ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼š<br>
        <a id="affiliateLink" href="https://affitch.com/signup?ref=yashio-gold" target="_blank">ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚µã‚¤ãƒˆã¸ç§»å‹•</a>
    </div>

    <script>
        // ã€é‡è¦ã€‘ã“ã“ã«GASã§å–å¾—ã—ãŸã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã‚’è¨˜å…¥ã—ã¾ã™
        const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzaRGEl8LardvIO_jKxd5Mirf2-iwWi0ZHRC6ZPelxBfivVZavdj3v73LFJuq28EQ/exec';
        // ã€é‡è¦ã€‘LIFF IDã‚’ã“ã“ã«è¨­å®šã—ã¾ã™
        const LIFF_ID = '2008433362-nR8Alpk2'; 
        // ã€æ³¨æ„ã€‘ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚µã‚¤ãƒˆã®URLã‚’ href="..." ã«ã‚‚ç›´æ¥è¨˜è¿°ã—ã¦ãã ã•ã„
        
        const form = document.getElementById('registrationForm');
        const loading = document.getElementById('loadingMessage');
        const errorMsg = document.getElementById('errorMessage');

        async function initializeLiff() {
            try {
                // åˆæœŸåŒ–ãŒæˆåŠŸã—ãŸã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                await liff.init({ liffId: LIFF_ID });
                console.log('LIFF initialization successful');
                loading.style.display = 'none';
                form.style.display = 'block';

            } catch (err) {
                // åˆæœŸåŒ–å¤±æ•—æ™‚ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                console.error('LIFF initialization failed', err);
                loading.style.display = 'none';
                errorMsg.style.display = 'block';
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯å…·ä½“çš„ãªåŸå› ã‚’ä¼ãˆãšã€è¨­å®šã®å•é¡Œã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºå”†
            }
        }

        document.getElementById('registrationForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // ... (ãƒ‡ãƒ¼ã‚¿é€ä¿¡å‡¦ç†ã¯çœç•¥ã›ãšã€å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¦ãã ã•ã„) ...
            
            const submitButton = document.getElementById('submitButton');
            submitButton.disabled = true;
            submitButton.textContent = 'é€ä¿¡ä¸­...';

            try {
                // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const formData = {
                    hospitalName: document.getElementById('hospitalName').value,
                    representativeName: document.getElementById('representativeName').value,
                    address: document.getElementById('address').value,
                    phoneNumber: document.getElementById('phoneNumber').value,
                };

                // GASã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
                const response = await fetch(GAS_ENDPOINT, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();

                if (result.status === 'success') {
                    // æˆåŠŸæ™‚ã®å‡¦ç†
                    document.getElementById('registrationForm').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                } else {
                    alert('ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
                }

            } catch (error) {
                console.error('Submission error:', error);
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ç½®ã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹';
            }
        });

        // LIFFã®åˆæœŸåŒ–ã‚’é–‹å§‹
        initializeLiff();
    </script>
</body>
</html>

