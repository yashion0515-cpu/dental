<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">

  <!-- â˜… LINEå¯¾ç­– viewportï¼ˆé‡è¦ï¼‰ -->
  <meta name="viewport"
        content="width=device-width,
                 initial-scale=1,
                 minimum-scale=1,
                 maximum-scale=1,
                 user-scalable=no">

  <title>é‡‘ä¹³æ­¯ å–æ‰±æ­¯ç§‘åŒ»é™¢ ç™»éŒ²</title>
    
 <script src="https://static.line-scdn.net/liff/sdk/2.16.1/liff.js"></script>


  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/sdk/2.16.1/liff.js"></script>

  <style>
    /* ===== å…±é€š ===== */
    * {
      box-sizing: border-box;
    }

    html {
      font-size: 18px;
      -webkit-text-size-adjust: 100%;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      background: #f4f4f4;
      color: #333;
    }

    .container {
      width: 100%;
      padding: 16px;
      background: #fff;
    }

    h1 {
      font-size: 18px;
      text-align: center;
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
    }

    input {
      width: 100%;
      font-size: 16px;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      width: 100%;
      font-size: 16px;
      padding: 14px;
      border-radius: 24px;
      border: none;
      background: #00B900;
      color: #fff;
      font-weight: bold;
    }

    /* ===== å®Œäº†ç”»é¢ ===== */
    .success-message {
      display: none;
      padding: 20px;
    }

    .success-card {
      border: 1px solid #d4af37;
      border-radius: 12px;
      padding: 24px;
      background: #fffdf8;
      text-align: center;
    }

    .success-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 12px;
    }

    .success-text {
      font-size: 15px;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .affiliate-button {
      display: inline-block;
      padding: 14px 28px;
      border-radius: 30px;
      background: linear-gradient(135deg, #d4af37, #f5e08a);
      color: #000;
      font-weight: bold;
      text-decoration: none;
      font-size: 16px;
    }
  </style>
</head>

<body>

<div class="container" id="formArea">
  <h1>é‡‘ä¹³æ­¯ å–æ‰±æ­¯ç§‘åŒ»é™¢ ç™»éŒ²</h1>

  <form id="registrationForm">
    <label>æ­¯ç§‘åŒ»é™¢å</label>
    <input type="text" id="hospitalName" required>

    <label>ä»£è¡¨è€…å</label>
    <input type="text" id="representativeName" required>

    <label>éƒµä¾¿ç•ªå·</label>
    <input type="text" id="postalCode" placeholder="ä¾‹ï¼š1234567" required>

    <label>ä½æ‰€</label>
    <input type="text" id="address" required>

    <label>é›»è©±ç•ªå·</label>
    <input type="tel" id="phoneNumber" required>

    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
    <input type="email" id="email" required>

    <button type="submit">æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹</button>
  </form>
</div>

<div class="success-message" id="successMessage">
  <div class="success-card">
    <div class="success-title">ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ ğŸ‰</div>

    <div class="success-text">
      ã”ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>
      ç¶šã„ã¦å ±é…¬ã‚’å—ã‘å–ã‚‹ãŸã‚ã«<br>
      <strong>ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆç™»éŒ²</strong>ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚
    </div>

    <a class="affiliate-button"
       href="https://affitch.com/signup?ref=yashio-gold"
       target="_blank">
      ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆç™»éŒ²ã¸é€²ã‚€ â†’
    </a>
  </div>
</div>

<script>
/* ===== è¨­å®š ===== */
const LIFF_ID = '2008433362-NxOdJgkP';
const GAS_ENDPOINT =
  'https://script.google.com/macros/s/AKfycbx8uMGtWPWTbl8T30JxhDORnUZWynS8VnDvstgTRZ7cSJrnM5d6AcnMaPeuH9I9KoE/exec';

/* ===== LIFFåˆæœŸåŒ– ===== */
async function initLiff() {
  try {
    await liff.init({ liffId: LIFF_ID });

    if (!liff.isInClient()) {
      document.body.innerHTML =
        '<p style="padding:20px">LINEã‚¢ãƒ—ãƒªå†…ã‹ã‚‰é–‹ã„ã¦ãã ã•ã„</p>';
    }
  } catch (e) {
    console.error(e);
    document.body.innerHTML =
      '<p style="padding:20px">LIFFåˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
  }
}

window.onload = initLiff;

/* ===== éƒµä¾¿ç•ªå· â†’ ä½æ‰€è‡ªå‹•å…¥åŠ› ===== */
document.getElementById('postalCode').addEventListener('blur', async function () {
  const zip = this.value.replace('-', '');

  if (!/^\d{7}$/.test(zip)) return;

  try {
    const res = await fetch(
      `https://zipcloud.ibsnet.co.jp/api/search?zipcode=${zip}`
    );
    const data = await res.json();

    if (data.results) {
      const a = data.results[0];
      document.getElementById('address').value =
        a.address1 + a.address2 + a.address3;
    }
  } catch (e) {
    console.log('éƒµä¾¿ç•ªå·å–å¾—å¤±æ•—');
  }
});

/* ===== ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ ===== */
document.getElementById('registrationForm').addEventListener('submit', async e => {
  e.preventDefault();

  const payload = {
    hospitalName: hospitalName.value,
    representativeName: representativeName.value,
    postalCode: postalCode.value,
    address: address.value,
    phoneNumber: phoneNumber.value,
    email: email.value
  };

  try {
    const res = await fetch(GAS_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    });

    const result = await res.json();

    if (result.status === 'success') {
      document.getElementById('formArea').style.display = 'none';
      document.getElementById('successMessage').style.display = 'block';
      window.scrollTo(0, 0);
    } else {
      alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }

  } catch (e) {
    alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    console.error(e);
  }
});
</script>

</body>
</html>
