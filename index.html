<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width,
               initial-scale=1,
               maximum-scale=1,
               user-scalable=no">

<title>é‡‘ä¹³æ­¯ å–æ‰±æ­¯ç§‘åŒ»é™¢ ç™»éŒ²</title>

<!-- LIFF SDKï¼ˆã‚ã£ã¦ã‚‚ç„¡ãã¦ã‚‚å‹•ãï¼‰ -->
<script src="https://static.line-scdn.net/liff/sdk/2.16.1/liff.js"></script>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 0;
  background: #f4f4f4;
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
}

.container {
  width: 100%;
  max-width: 390px;
  margin: 0 auto;
  padding: 20px;
  background: #fff;
}

h1 {
  font-size: 20px;
  text-align: center;
  margin-bottom: 20px;
}

label {
  font-size: 16px;
  font-weight: bold;
  display: block;
  margin-bottom: 6px;
}

input {
  width: 100%;
  font-size: 18px;
  padding: 14px;
  margin-bottom: 18px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  width: 100%;
  font-size: 18px;
  padding: 16px;
  border-radius: 30px;
  border: none;
  background: linear-gradient(135deg,#d4af37,#f5e08a);
  color: #000;
  font-weight: bold;
}

.success {
  display: none;
  text-align: center;
  padding: 30px 20px;
}

.success h2 {
  font-size: 22px;
  margin-bottom: 16px;
}

.success p {
  font-size: 16px;
  margin-bottom: 24px;
}

.success a {
  display: inline-block;
  padding: 16px 30px;
  border-radius: 30px;
  font-size: 18px;
  font-weight: bold;
  text-decoration: none;
  color: #000;
  background: linear-gradient(135deg,#d4af37,#f5e08a);
}
</style>
</head>

<body>

<div class="container" id="formArea">
  <h1>é‡‘ä¹³æ­¯ å–æ‰±æ­¯ç§‘åŒ»é™¢ ç™»éŒ²</h1>

  <form id="form">
    <label>æ­¯ç§‘åŒ»é™¢å</label>
    <input id="hospitalName" required>

    <label>ä»£è¡¨è€…å</label>
    <input id="representativeName" required>

    <label>éƒµä¾¿ç•ªå·</label>
    <input id="postalCode" placeholder="123-4567" required>

    <label>ä½æ‰€</label>
    <input id="address" required>

    <label>é›»è©±ç•ªå·</label>
    <input id="phoneNumber" required>

    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
    <input id="email" type="email" required>

    <button id="submitBtn">ç™»éŒ²ã™ã‚‹</button>
  </form>
</div>

<div class="success" id="successArea">
  <h2>ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ ğŸ‰</h2>
  <p>
    ç¶šã„ã¦å ±é…¬ã‚’å—ã‘å–ã‚‹ãŸã‚ã«<br>
    <strong>æŒ¯è¾¼å£åº§ç™»éŒ²</strong>ã‚’ãŠé¡˜ã„ã—ã¾ã™
  </p>
  <a href="https://affitch.com/signup?ref=yashio-gold" target="_blank">
    æŒ¯è¾¼å£åº§ç™»éŒ²ã¸é€²ã‚€ â†’
  </a>
</div>

<script>
/* ===== è¨­å®š ===== */
const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbzmFpmwLLr1-_yeCAJar360z25nmVO7yBtQrjLsEhjGBoF1qeml25KyJU5Xgxq0sN51/exec";
const LIFF_ID = "2008433362-NxOdJgkP";

/* ===== LIFFï¼ˆå¤±æ•—ã—ã¦ã‚‚ç„¡è¦–ï¼‰ ===== */
window.onload = async () => {
  if (window.liff) {
    try {
      await liff.init({ liffId: LIFF_ID });
    } catch(e) {
      console.log("LIFFãªã—ã§ç¶šè¡Œ");
    }
  }
};

/* ===== éƒµä¾¿ç•ªå· â†’ ä½æ‰€ ===== */
let zipFetched = false;

document.getElementById("postalCode").addEventListener("input", async e => {
  const zip = e.target.value.replace("-", "");

  if (!/^\d{7}$/.test(zip)) {
    zipFetched = false;
    return;
  }

  if (zipFetched) return;
  zipFetched = true;

  try {
    const response = await fetch(
      `https://zipcloud.ibsnet.co.jp/api/search?zipcode=${zip}`
    );
    const result = await response.json();

    if (result.status === 200 && result.results) {
      const a = result.results[0];
      document.getElementById("address").value =
        a.address1 + a.address2 + a.address3;
    }
  } catch (err) {
    console.error("éƒµä¾¿ç•ªå·å–å¾—å¤±æ•—", err);
  }
});

/* ===== é€ä¿¡ ===== */
document.getElementById("form").addEventListener("submit", async e => {
  e.preventDefault();

  document.getElementById("submitBtn").disabled = true;

  const data = {
    hospitalName: hospitalName.value,
    representativeName: representativeName.value,
    postalCode: postalCode.value,
    address: address.value,
    phoneNumber: phoneNumber.value,
    email: email.value
  };

  try {
    const res = await fetch(GAS_ENDPOINT, {
      method: "POST",
      body: JSON.stringify(data)
    });
    const json = await res.json();

    if (json.status === "success") {
      document.getElementById("formArea").style.display = "none";
      document.getElementById("successArea").style.display = "block";
    } else {
      alert("é€ä¿¡å¤±æ•—");
    }

  } catch {
    alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼");
  }
});
</script>

</body>
</html>

